# [Create a Language Understanding solution with Azure AI Language](https://learn.microsoft.com/en-us/training/paths/create-language-solution-azure-cognitive-services/)

## [Build a conversational language understanding model](https://learn.microsoft.com/en-us/training/modules/build-language-understanding-model/)

### Understand resources for building a conversational language understanding model
* To use the Language Understanding service to develop an NLP solution, create a Language resource in Azure. It will be used for both authoring your model and processing prediction requests from client applications.
* Azure AI Language has various features, including sentiment analysis, key phrase extraction, entity recognition, intent recognition, and text classification. 
* Some features, such as conversational language understanding and custom named entity recognition require a model to be built for prediction.
* Build your model
  1. For features that require a model for prediction - build, train and deploy that model before using it to make a prediction. This building and training will teach the Azure AI Language service what to look for.
  1. Portal -> Azure AI services -> Language Service -> Create -> Need a key and the endpoint
* Use the REST API - One way to build your model
  1. The pattern would be to create your project, import data, train, deploy, then use your model.
  1. These tasks are done asynchronously; submit a request to the appropriate URI for each step, and then send another request to get the status of that job.
  1. Example, if deploy a model for a conversational language understanding project, you'd submit the deployment job, and then check on the deployment job status.
* Authentication - providing the following header. Key	-> Ocp-Apim-Subscription-Key,  Value -> The key to your resource
* Request deployment
  1. Submit a POST request to the following endpoint.
    ```
    {ENDPOINT}/language/authoring/analyze-conversations/projects/{PROJECT-NAME}/deployments/{DEPLOYMENT-NAME}?api-version={API-VERSION}
    ```
  | Placeholder |	Value |	Example |
  |--|--|--|
  | {ENDPOINT} | The endpoint of your Azure AI Language resource |	https://<your-subdomain>.cognitiveservices.azure.com |
  | {PROJECT-NAME} | The name for your project. This value is case-sensitive |		myProject |
  | {DEPLOYMENT-NAME} | The name for your deployment. This value is case-sensitive |		staging |
  | {API-VERSION} | The version of the API you're calling |		2022-05-01 |
  
  1. Include the following body with your request. {MODEL-NAME} - 	The model name that will be assigned to your deployment. This value is case-sensitive.
    ```
    {
      "trainedModelLabel": "{MODEL-NAME}",
    }
    ```
  1. Successfully submitting your request will receive a 202 response, with a response header of operation-location. This header will have a URL with which to request the status, formatted like this:
    ```
    {ENDPOINT}/language/authoring/analyze-conversations/projects/{PROJECT-NAME}/deployments/{DEPLOYMENT-NAME}/jobs/{JOB-ID}?api-version={API-VERSION}
    ```
  1. Get deployment status - Submit a GET request to the URL from the response header above. 
    ```
    {ENDPOINT}/language/authoring/analyze-conversations/projects/{PROJECT-NAME}/deployments/{DEPLOYMENT-NAME}/jobs/{JOB-ID}?api-version={API-VERSION}
    ```
    1. {ENDPOINT}	- The endpoint for authenticating your API request
    1. {PROJECT-NAME}	- The name for your project (case-sensitive)
    1. {DEPLOYMENT-NAME} -	The name for your deployment (case-sensitive)
    1. {JOB-ID}	- The ID for locating your model's training status, found in the header value detailed above in the deployment request
    1. {API-VERSION} -	The version of the API you're calling
  1. The response body will give the deployment status details. The status field will have the value of succeeded when the deployment is complete.
    ```
    {
        "jobId":"{JOB-ID}",
        "createdDateTime":"String",
        "lastUpdatedDateTime":"String",
        "expirationDateTime":"String",
        "status":"running"
    }
    ```
  1. [For a full walkthrough of each step with example requests, see the conversational understanding quickstart.](https://learn.microsoft.com/en-us/azure/ai-services/language-service/conversational-language-understanding/quickstart?pivots=rest-api#create-a-clu-project)

* Use Language Studio
  1. Visual method of building, training, and deploying your model
  1. Choose to create a Conversational language understanding project. 
  1. Once the project is created, then go through the same process as above to build, train, and deploy your model.
  1. ![](https://learn.microsoft.com/en-us/training/wwl-data-ai/build-language-understanding-model/media/language-studio-conversational-small.png)

* Query your model
  1. To query your model for a prediction, create a POST request to the appropriate URL with the appropriate body specified. 
  1. For built in features such as language detection or sentiment analysis, you'll query the analyze-text endpoint.
    ```
    {ENDPOINT}/language/:analyze-text?api-version={API-VERSION}
    
      1. {ENDPOINT}	The endpoint for authenticating your API request
      2. {API-VERSION}	The version of the API you're calling
    ```
  1. Within the body of that request, you must specify the kind parameter, which tells the service what type of language understanding you're requesting.
  1. If you want to detect the language, for example, the JSON body would look something like the following.
    ```
    {
        "kind": "LanguageDetection",
        "parameters": {
            "modelVersion": "latest"
        },
        "analysisInput":{
            "documents":[
                {
                    "id":"1",
                    "text": "This is a document written in English."
                }
            ]
        }
    }
    ```
  1. A sample response to your query would be similar to the following.
    ```
    {
        "kind": "LanguageDetectionResults",
        "results": {
            "documents": [{
                "id": "1",
                "detectedLanguage": {
                    "name": "English",
                    "iso6391Name": "en",
                    "confidenceScore": 1.0
                },
                "warnings": []
            }],
            "errors": [],
            "modelVersion": "{VERSION}"
        }
    }
    ```
  1. Other language features, such as the conversational language understanding discussed above, require the request be routed to a different endpoint. 
  1. For example, the conversational language understanding request would be sent to the following.
    ```
    {ENDPOINT}/language/:analyze-conversations?api-version={API-VERSION}
      1. {ENDPOINT}	The endpoint for authenticating your API request
      2. {API-VERSION}	The version of the API you're calling
    ```
  1. That request would include a JSON body similar to the following.
    ```
    {
      "kind": "Conversation",
      "analysisInput": {
        "conversationItem": {
          "id": "1",
          "participantId": "1",
          "text": "Sample text"
        }
      },
      "parameters": {
        "projectName": "{PROJECT-NAME}",
        "deploymentName": "{DEPLOYMENT-NAME}",
        "stringIndexType": "TextElement_V8"
      }
    }
    
      1. {PROJECT-NAME}	The name of the project where you built your model
      2. {DEPLOYMENT-NAME}	The name of your deployment
    ````
  1. A sample response to your query would be similar to the following.
    ```
    {
      "kind": "ConversationResult",
      "result": {
        "query": "String",
        "prediction": {
          "topIntent": "intent1",
          "projectKind": "Conversation",
          "intents": [
            {
              "category": "intent1",
              "confidenceScore": 1
            },
            {
              "category": "intent2",
              "confidenceScore": 0
            }
          ],
          "entities": [
            {
              "category": "entity1",
              "text": "text",
              "offset": 7,
              "length": 4,
              "confidenceScore": 1
            }
          ]
        }
      }
    }
    ```
  1. [For full documentation on features, including examples and how-to guides, see the Azure AI Language documentation documentation pages.](https://learn.microsoft.com/en-us/azure/ai-services/language-service/)
